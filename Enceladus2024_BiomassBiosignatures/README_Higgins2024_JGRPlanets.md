This directory contains the code used to produce and analyse the results in our manuscript entitled: *"Quantifying uncertainty in biomass and production of biotic carbon in Enceladus' notional methanogenic biosphere"*, but will soon be expanded for some more comprehensive biosignature analyses.

This code should be able to replicate the chemical speciation and Monte Carlo models described in the manuscript. If you are having trouble recreating this work with a future version, try going back to the archived code on Zenodo described in the data availability section of that manuscript. The datasets that we generated have been archived in figshare (doi: 10.6084/m9.figshare.22557706) and can be extracted and placed into the `data` directory for further analysis if required.

The code is designed to be used in the directory layout specified in the [main NutMEG-Implementations README](https://github.com/pmhiggins/NutMEG-Implementations/README.md).

There are two cornerstones to this analysis, the chemical speciation analyses in the `SpeciationAnalyses` directory, and the Monte Carlo habitability, biomass and biosignautures modeling in the `Biomass` directory. The former is generated by the `reaktoro` package for chemical systems and the latter makes use of the in-built NutMEG saved_organism `TypicalOptimalMethanogen` and the saved_system `Enceladus`.



# Monte Carlo Habitability biomass and turnover
Monte Carlo simulations were performed and saved using the `MCrun.py` file, which creates a `BMDRTO_MC` object, and saves output to a csv file. The `MCrun.py` has code to recreate the exact Monte Carlo simulations performed in Higgins et al., 2024. Note that output will not be exactly identical owing to the probabilistic sampling of this method.

Before performing a Monte Carlo simulation, your ranges of carbonate speciation should first be made and saved as described below.

# Chemical Speciation
There are several differences between reaktoro v1 and v2 and at the time this was written, NutMEG uses v1 but the speciation was better performed with v2. Therefore, speciation modelling should be performed in the EncBmBs_utils/ChemicalSpeciation directory specifically in a conda environment with reaktoro v2 isntalled. NutMEG will be updated for improved compatability in due course, but currently only works with v1.

`EncBmBs_utils/ChemicalSpeciation/SpecSave.py` can be used to run the speciations used in this work and save them to csv files for later retrieval. The speciation itself uses the `EncSpecSetup`, `EncSpecSolver`, and `EncSpecSaver` classes.



# Code for regenerating specific figures in the text

Figure 1, S1, S2: `Biomass/Analysis/Plotting/HabitabilityProbability.py` requires an MC simulation to have been performed and saved over some T and pH space.

Figure 2: `SpeciationAnalyses/SI_threshold_plot.py`, requires the speciation datafile 'spec_T_273-473_pH_7-12' to be generated or downloaded from figshare.

Figure 3: `BiomassDistributions.py` requires an MC simulation to have been performed and saved over some T and pH space.

Figure 4, S3: `Biomass/Analysis/Plotting/BiomassWindow.py` requires an MC simulation to have been performed and saved over some T and pH space. Additionally requires a speciation to be saved.

Figure 5, S4: `Biomass/Analysis/Plotting/TurnoverPlumeRelations.py` data for these plots are hard-coded, based on output generated for the main text and other figures.

Figures S5,S6,S7,S8,S10,S11,S13,S14: `spec_plots.py`, requires the 'spec_T_273-473_pH_7-12' speciations to be generated or downloaded from figshare. This code will also generate many bonus figures for all the species and interesting parameters generated with the speciation results.

Figure S9: `SpeciationAnalyses/CO2_comp_H2021.py`, requires the 'spec_T_273-473_pH_7-12' speciations to be generated or downloaded from figshare.

Figures S12,S15: `model_ratio_plots.py`, requires the 'spec_T_273-473_pH_7-12' speciations to be generated or downloaded from figshare.
